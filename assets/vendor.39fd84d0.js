var X=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},w={exports:{}},b;typeof window!="undefined"?b=window:typeof X!="undefined"?b=X:typeof self!="undefined"?b=self:b={};var k=b,W=q,j=Object.prototype.toString;function q(a){if(!a)return!1;var n=j.call(a);return n==="[object Function]"||typeof a=="function"&&n!=="[object RegExp]"||typeof window!="undefined"&&(a===window.setTimeout||a===window.alert||a===window.confirm||a===window.prompt)}var U=function(a){return a.replace(/^\s+|\s+$/g,"")},V=function(a){return Object.prototype.toString.call(a)==="[object Array]"},Y=function(a){if(!a)return{};for(var n={},t=U(a).split(`
`),i=0;i<t.length;i++){var e=t[i],r=e.indexOf(":"),u=U(e.slice(0,r)).toLowerCase(),s=U(e.slice(r+1));typeof n[u]=="undefined"?n[u]=s:V(n[u])?n[u].push(s):n[u]=[n[u],s]}return n},z=$,Q=Object.prototype.hasOwnProperty;function $(){for(var a={},n=0;n<arguments.length;n++){var t=arguments[n];for(var i in t)Q.call(t,i)&&(a[i]=t[i])}return a}var F=k,J=W,K=Y,Z=z;w.exports=p;w.exports.default=p;p.XMLHttpRequest=F.XMLHttpRequest||ie;p.XDomainRequest="withCredentials"in new p.XMLHttpRequest?p.XMLHttpRequest:F.XDomainRequest;ee(["get","put","post","patch","head","delete"],function(a){p[a==="delete"?"del":a]=function(n,t,i){return t=D(n,t,i),t.method=a.toUpperCase(),M(t)}});function ee(a,n){for(var t=0;t<a.length;t++)n(a[t])}function te(a){for(var n in a)if(a.hasOwnProperty(n))return!1;return!0}function D(a,n,t){var i=a;return J(n)?(t=n,typeof a=="string"&&(i={uri:a})):i=Z(n,{uri:a}),i.callback=t,i}function p(a,n,t){return n=D(a,n,t),M(n)}function M(a){if(typeof a.callback=="undefined")throw new Error("callback argument missing");var n=!1,t=function(R,_,O){n||(n=!0,a.callback(R,_,O))};function i(){s.readyState===4&&setTimeout(u,0)}function e(){var c=void 0;if(s.response?c=s.response:c=s.responseText||re(s),v)try{c=JSON.parse(c)}catch{}return c}function r(c){return clearTimeout(T),c instanceof Error||(c=new Error(""+(c||"Unknown XMLHttpRequest Error"))),c.statusCode=0,t(c,m)}function u(){if(!l){var c;clearTimeout(T),a.useXDR&&s.status===void 0?c=200:c=s.status===1223?204:s.status;var R=m,_=null;return c!==0?(R={body:e(),statusCode:c,method:h,headers:{},url:f,rawRequest:s},s.getAllResponseHeaders&&(R.headers=K(s.getAllResponseHeaders()))):_=new Error("Internal XMLHttpRequest Error"),t(_,R,R.body)}}var s=a.xhr||null;s||(a.cors||a.useXDR?s=new p.XDomainRequest:s=new p.XMLHttpRequest);var o,l,f=s.url=a.uri||a.url,h=s.method=a.method||"GET",g=a.body||a.data,d=s.headers=a.headers||{},E=!!a.sync,v=!1,T,m={body:void 0,headers:{},statusCode:0,method:h,url:f,rawRequest:s};if("json"in a&&a.json!==!1&&(v=!0,d.accept||d.Accept||(d.Accept="application/json"),h!=="GET"&&h!=="HEAD"&&(d["content-type"]||d["Content-Type"]||(d["Content-Type"]="application/json"),g=JSON.stringify(a.json===!0?g:a.json))),s.onreadystatechange=i,s.onload=u,s.onerror=r,s.onprogress=function(){},s.onabort=function(){l=!0},s.ontimeout=r,s.open(h,f,!E,a.username,a.password),E||(s.withCredentials=!!a.withCredentials),!E&&a.timeout>0&&(T=setTimeout(function(){if(!l){l=!0,s.abort("timeout");var c=new Error("XMLHttpRequest timeout");c.code="ETIMEDOUT",r(c)}},a.timeout)),s.setRequestHeader)for(o in d)d.hasOwnProperty(o)&&s.setRequestHeader(o,d[o]);else if(a.headers&&!te(a.headers))throw new Error("Headers cannot be set on an XDomainRequest object");return"responseType"in a&&(s.responseType=a.responseType),"beforeSend"in a&&typeof a.beforeSend=="function"&&a.beforeSend(s),s.send(g||null),s}function re(a){try{if(a.responseType==="document")return a.responseXML;var n=a.responseXML&&a.responseXML.documentElement.nodeName==="parsererror";if(a.responseType===""&&!n)return a.responseXML}catch{}return null}function ie(){}var C=w.exports,A=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(a){return typeof a}:function(a){return a&&typeof Symbol=="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},I=function(a,n){if(!(a instanceof n))throw new TypeError("Cannot call a class as a function")},B=function(){function a(n,t){for(var i=0;i<t.length;i++){var e=t[i];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(n,e.key,e)}}return function(n,t,i){return t&&a(n.prototype,t),i&&a(n,i),n}}(),S=function(a){if(Array.isArray(a)){for(var n=0,t=Array(a.length);n<a.length;n++)t[n]=a[n];return t}else return Array.from(a)},x="";function ae(a){return`
<table style="background-color: #8CE; width: 100%; height: 100%;"><tr>
<td align="center">
<div style="display: table-cell; vertical-align: middle;">
<div style="">`+a+`</div>
</div>
</td></tr></table>
`}var ne=`
	This page requires a browser that supports WebGL.<br/>
	<a href="http://get.webgl.org">Click here to upgrade your browser.</a>
`,se=`
	It does not appear your computer can support WebGL.<br/>
	<a href="http://get.webgl.org/troubleshooting/">Click here for more information.</a>
`,ue=1,oe=2;function le(a,n,t){function i(u){var s=a.parentNode;s&&(s.innerHTML=ae(u))}function e(u,s){typeof t=="function"?t(u):i(s)}if(!window.WebGLRenderingContext)return e(ue,ne),null;var r=he(a,n);return r?r.getExtension("OES_standard_derivatives"):e(oe,se),r}function he(a,n){for(var t=["webgl","experimental-webgl"],i=null,e=0;e<t.length;++e)try{i=a.getContext(t[e],n)}catch{if(i)break}return i}function y(a,n,t,i){var e=a.gl,r=e.createShader(t);e.shaderSource(r,n),e.compileShader(r);var u=e.getShaderParameter(r,e.COMPILE_STATUS);return u?r:(x=e.getShaderInfoLog(r),console.error("*** Error compiling shader "+r+":"+x),a.trigger("error",{shader:r,source:n,type:t,error:x,offset:i||0}),e.deleteShader(r),null)}function G(a,n,t,i){for(var e=a.gl,r=e.createProgram(),u=0;u<n.length;++u)e.attachShader(r,n[u]);if(t)for(var s=0;s<t.length;++s)e.bindAttribLocation(r,i?i[s]:s,t[s]);e.linkProgram(r);var o=e.getProgramParameter(r,e.LINK_STATUS);return o?r:(x=e.getProgramInfoLog(r),console.log("Error in program linking:"+x),e.deleteProgram(r),null)}function P(a){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,t=[];for(var i in a){var e=a[i],r=void 0;if(n&&(i=n+"."+i),typeof e=="number")t.push({type:"float",method:"1f",name:i,value:e});else if(Array.isArray(e)){if(typeof e[0]=="number")e.length===1?t.push({type:"float",method:"1f",name:i,value:e}):e.length>=2&&e.length<=4?t.push({type:"vec"+e.length,method:e.length+"fv",name:i,value:e}):e.length>4&&t.push({type:"float[]",method:"1fv",name:i+"[0]",value:e});else if(typeof e[0]=="string")t.push({type:"sampler2D",method:"1i",name:i,value:e});else if(Array.isArray(e[0])&&typeof e[0][0]=="number"){if(e[0].length>=2&&e[0].length<=4)for(r=0;r<e.length;r++)t.push({type:"vec"+e[0].length,method:e[r].length+"fv",name:i+"["+r+"]",value:e[r]})}else if(A(e[0])==="object")for(r=0;r<e.length;r++)t.push.apply(t,S(P(e[r],i+"["+r+"]")))}else typeof e=="boolean"?t.push({type:"bool",method:"1i",name:i,value:e}):typeof e=="string"?t.push({type:"sampler2D",method:"1i",name:i,value:e}):(typeof e=="undefined"?"undefined":A(e))==="object"&&t.push.apply(t,S(P(e,i)))}return t}function fe(a){return a.getBoundingClientRect().top+a.height>0&&a.getBoundingClientRect().top<(window.innerHeight||document.documentElement.clientHeight)}function N(a){return(a&a-1)==0}function de(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}function ge(a,n){return a&&n?a.toString()!==n.toString():!1}function H(a){var n=new Set;return Object.assign(a,{on:function(i,e){var r={};r[i]=e,n.add(r)},off:function(i,e){if(e){var r={};r[i]=e,n.delete(r)}else{var u=!0,s=!1,o=void 0;try{for(var l=n[Symbol.iterator](),f;!(u=(f=l.next()).done);u=!0){var h=f.value,g=!0,d=!1,E=void 0;try{for(var v=Object.keys(h)[Symbol.iterator](),T;!(g=(T=v.next()).done);g=!0){var m=T.value;if(m===i){n.delete(h);return}}}catch(c){d=!0,E=c}finally{try{!g&&v.return&&v.return()}finally{if(d)throw E}}}}catch(c){s=!0,o=c}finally{try{!u&&l.return&&l.return()}finally{if(s)throw o}}}},listSubscriptions:function(){var i=!0,e=!1,r=void 0;try{for(var u=n[Symbol.iterator](),s;!(i=(s=u.next()).done);i=!0){var o=s.value;console.log(o)}}catch(l){e=!0,r=l}finally{try{!i&&u.return&&u.return()}finally{if(e)throw r}}},subscribe:function(i){n.add(i)},unsubscribe:function(i){n.delete(i)},unsubscribeAll:function(){n.clear()},trigger:function(i){for(var e=arguments.length,r=Array(e>1?e-1:0),u=1;u<e;u++)r[u-1]=arguments[u];var s=!0,o=!1,l=void 0;try{for(var f=n[Symbol.iterator](),h;!(s=(h=f.next()).done);s=!0){var g=h.value;typeof g[i]=="function"&&g[i].apply(g,S(r))}}catch(d){o=!0,l=d}finally{try{!s&&f.return&&f.return()}finally{if(o)throw l}}}})}var L=function(){function a(n,t){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};I(this,a),H(this),this.gl=n,this.texture=n.createTexture(),this.texture&&(this.valid=!0),this.bind(),this.name=t,this.source=null,this.sourceType=null,this.loading=null,this.setData(1,1,new Uint8Array([0,0,0,255]),{filtering:"linear"}),this.setFiltering(i.filtering),this.load(i)}return B(a,[{key:"destroy",value:function(){!this.valid||(this.gl.deleteTexture(this.texture),this.texture=null,delete this.data,this.data=null,this.valid=!1)}},{key:"bind",value:function(t){!this.valid||(typeof t=="number"&&a.activeUnit!==t&&(this.gl.activeTexture(this.gl.TEXTURE0+t),a.activeUnit=t),a.activeTexture!==this.texture&&(this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture),a.activeTexture=this.texture))}},{key:"load",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.loading=null,typeof t.url=="string"?(this.url===void 0||t.url!==this.url)&&this.setUrl(t.url,t):t.element?this.setElement(t.element,t):t.data&&t.width&&t.height&&this.setData(t.width,t.height,t.data,t)}},{key:"setUrl",value:function(t){var i=this,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!!this.valid)return this.url=t,this.source=this.url,this.sourceType="url",this.loading=new Promise(function(r,u){var s=t.split(".").pop().toLowerCase(),o=s==="ogv"||s==="webm"||s==="mp4",l=void 0;o?(l=document.createElement("video"),l.autoplay=!0,e.filtering="nearest"):l=new Image,l.onload=function(){try{i.setElement(l,e)}catch(f){console.log("Texture '"+i.name+"': failed to load url: '"+i.source+"'",f,e)}r(i)},l.onerror=function(f){console.log("Texture '"+i.name+"': failed to load url: '"+i.source+"'",f,e),r(i)},de()&&i.source.slice(0,5)==="data:"||(l.crossOrigin="anonymous"),l.src=i.source,o&&i.setElement(l,e)}),this.loading}},{key:"setData",value:function(t,i,e){var r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return this.width=t,this.height=i,this.source=e,this.sourceType="data",this.update(r),this.setFiltering(r),this.loading=Promise.resolve(this),this.loading}},{key:"setElement",value:function(t,i){var e=this,r=t;if(typeof t=="string"&&(t=document.querySelector(t)),t instanceof HTMLCanvasElement||t instanceof HTMLImageElement||t instanceof HTMLVideoElement)this.source=t,this.sourceType="element",t instanceof HTMLVideoElement?(t.addEventListener("canplaythrough",function(){e.intervalID=setInterval(function(){e.update(i)},15)},!0),t.addEventListener("ended",function(){t.currentTime=0,t.play()},!0)):this.update(i),this.setFiltering(i);else{var u="the 'element' parameter (`element: "+JSON.stringify(r)+"`) must be a CSS ";u+="selector string, or a <canvas>, <image> or <video> object",console.log("Texture '"+this.name+"': "+u,i)}return this.loading=Promise.resolve(this),this.loading}},{key:"update",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};!this.valid||(this.bind(),this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,t.UNPACK_FLIP_Y_WEBGL!==!1),this.gl.pixelStorei(this.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.UNPACK_PREMULTIPLY_ALPHA_WEBGL||!1),this.sourceType==="element"&&(this.source instanceof HTMLCanvasElement||this.source instanceof HTMLVideoElement||this.source instanceof HTMLImageElement&&this.source.complete)?(this.source instanceof HTMLVideoElement?(this.width=this.source.videoWidth,this.height=this.source.videoHeight):(this.width=this.source.width,this.height=this.source.height),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,this.source)):this.sourceType==="data"&&this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.width,this.height,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,this.source),this.trigger("loaded",this))}},{key:"setFiltering",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!!this.valid){this.powerOf2=N(this.width)&&N(this.height);var i=this.powerOf2?"mipmap":"linear";this.filtering=t.filtering||i;var e=this.gl;this.bind(),this.powerOf2?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,t.TEXTURE_WRAP_S||t.repeat&&e.REPEAT||e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,t.TEXTURE_WRAP_T||t.repeat&&e.REPEAT||e.CLAMP_TO_EDGE),this.filtering==="mipmap"?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.generateMipmap(e.TEXTURE_2D)):this.filtering==="linear"?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR)):this.filtering==="nearest"&&(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST))):(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),this.filtering==="mipmap"&&(this.filtering="linear"),this.filtering==="nearest"?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST)):(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR)))}}}]),a}();L.getMaxTextureSize=function(a){return a.getParameter(a.MAX_TEXTURE_SIZE)};L.activeUnit=-1;var ce=function(){function a(n,t,i){var e=this;I(this,a),H(this),t=t||{},i=i||{},this.width=n.clientWidth,this.height=n.clientHeight,this.canvas=n,this.gl=void 0,this.program=void 0,this.textures={},this.buffers={},this.uniforms={},this.vbo={},this.isValid=!1,this.BUFFER_COUNT=0,this.vertexString=t.vertexString||`
#ifdef GL_ES
precision mediump float;
#endif

attribute vec2 a_position;
attribute vec2 a_texcoord;

varying vec2 v_texcoord;

void main() {
    gl_Position = vec4(a_position, 0.0, 1.0);
    v_texcoord = a_texcoord;
}
`,this.fragmentString=t.fragmentString||`
#ifdef GL_ES
precision mediump float;
#endif

varying vec2 v_texcoord;

void main(){
    gl_FragColor = vec4(0.0);
}
`;var r=le(n,t,i.onError);if(!r)return;if(this.gl=r,this.timeLoad=this.timePrev=performance.now(),this.timeDelta=0,this.forceRender=!0,this.paused=!1,this.realToCSSPixels=window.devicePixelRatio||1,n.style.backgroundColor=t.backgroundColor||"rgba(1,1,1,0)",n.hasAttribute("data-fragment"))this.fragmentString=n.getAttribute("data-fragment");else if(n.hasAttribute("data-fragment-url")){var u=n.getAttribute("data-fragment-url");C.get(u,function(v,T,m){e.load(m,e.vertexString)})}if(n.hasAttribute("data-vertex"))this.vertexString=n.getAttribute("data-vertex");else if(n.hasAttribute("data-vertex-url")){var s=n.getAttribute("data-vertex-url");C.get(s,function(v,T,m){e.load(e.fragmentString,m)})}if(this.load(),!this.program)return;var o=r.getAttribLocation(this.program,"a_texcoord");this.vbo.texCoords=r.createBuffer(),this.gl.bindBuffer(r.ARRAY_BUFFER,this.vbo.texCoords),this.gl.bufferData(r.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),r.STATIC_DRAW),this.gl.enableVertexAttribArray(o),this.gl.vertexAttribPointer(o,2,r.FLOAT,!1,0,0);var l=r.getAttribLocation(this.program,"a_position");if(this.vbo.vertices=r.createBuffer(),this.gl.bindBuffer(r.ARRAY_BUFFER,this.vbo.vertices),this.gl.bufferData(r.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),r.STATIC_DRAW),this.gl.enableVertexAttribArray(l),this.gl.vertexAttribPointer(l,2,r.FLOAT,!1,0,0),n.hasAttribute("data-textures")){var f=n.getAttribute("data-textures").split(",");for(var h in f)this.setUniform("u_tex"+h,f[h])}var g={x:0,y:0};document.addEventListener("mousemove",function(v){g.x=v.clientX||v.pageX,g.y=v.clientY||v.pageY},!1);var d=this;function E(){d.nMouse>1&&d.setMouse(g),d.resize()&&(d.forceRender=!0),d.render(),window.requestAnimationFrame(E)}return this.setMouse({x:0,y:0}),E(),this}return B(a,[{key:"destroy",value:function(){this.animated=!1,this.isValid=!1;for(var t in this.textures)t.destroy&&t.destroy();this.textures={};for(var i in this.attribs)this.gl.deleteBuffer(this.attribs[i]);this.gl.useProgram(null),this.gl.deleteProgram(this.program);for(var e in this.buffers){var r=this.buffers[e];this.gl.deleteProgram(r.program)}this.program=null,this.gl=null}},{key:"load",value:function(t,i){i&&(this.vertexString=i),t&&(this.fragmentString=t),this.animated=!1,this.nDelta=(this.fragmentString.match(/u_delta/g)||[]).length,this.nTime=(this.fragmentString.match(/u_time/g)||[]).length,this.nDate=(this.fragmentString.match(/u_date/g)||[]).length,this.nMouse=(this.fragmentString.match(/u_mouse/g)||[]).length,this.animated=this.nDate>1||this.nTime>1||this.nMouse>1;var e=this.fragmentString.search(/sampler2D/g);if(e)for(var r=this.fragmentString.split(`
`),u=0;u<r.length;u++){var s=r[u].match(/uniform\s*sampler2D\s*([\w]*);\s*\/\/\s*([\w|\:\/\/|\.|\-|\_]*)/i);if(s){var o=s[2].split(".").pop().toLowerCase();s[1]&&s[2]&&(o==="jpg"||o==="jpeg"||o==="png"||o==="ogv"||o==="webm"||o==="mp4")&&this.setUniform(s[1],s[2])}var l=r[u].match(/\s*void\s*main\s*/g);if(l)break}var f=y(this,this.vertexString,this.gl.VERTEX_SHADER),h=y(this,this.fragmentString,this.gl.FRAGMENT_SHADER);h?this.isValid=!0:(h=y(this,`void main(){
	gl_FragColor = vec4(1.0);
}`,this.gl.FRAGMENT_SHADER),this.isValid=!1);var g=G(this,[f,h]);this.gl.useProgram(g),this.gl.deleteShader(f),this.gl.deleteShader(h),this.program=g,this.change=!0,this.BUFFER_COUNT=0;var d=this.getBuffers(this.fragmentString);Object.keys(d).length&&this.loadPrograms(d),this.buffers=d,this.texureIndex=this.BUFFER_COUNT,this.trigger("load",{}),this.forceRender=!0,this.render()}},{key:"test",value:function(t,i,e){var r=this.vertexString,u=this.fragmentString,s=this.paused,o=this.gl.getExtension("EXT_disjoint_timer_query"),l=o.createQueryEXT(),f=this.isValid;(i||e)&&(this.load(i,e),f=this.isValid,this.forceRender=!0,this.render()),this.paused=!0,o.beginQueryEXT(o.TIME_ELAPSED_EXT,l),this.forceRender=!0,this.render(),o.endQueryEXT(o.TIME_ELAPSED_EXT);var h=this;function g(){h.paused=s,(i||e)&&h.load(u,r)}function d(){h.forceRender=!0,h.render();var E=o.getQueryObjectEXT(l,o.QUERY_RESULT_AVAILABLE_EXT),v=h.gl.getParameter(o.GPU_DISJOINT_EXT);if(E&&!v){var T={wasValid:f,frag:i||h.fragmentString,vert:e||h.vertexString,timeElapsedMs:o.getQueryObjectEXT(l,o.QUERY_RESULT_EXT)/1e6};g(),t(T)}else window.requestAnimationFrame(d)}d()}},{key:"loadTexture",value:function(t,i,e){var r=this;e||(e={}),typeof i=="string"?e.url=i:(typeof i=="undefined"?"undefined":A(i))==="object"&&i.data&&i.width&&i.height?(e.data=i.data,e.width=i.width,e.height=i.height):(typeof i=="undefined"?"undefined":A(i))==="object"&&(e.element=i),this.textures[t]?this.textures[t]&&(this.textures[t].load(e),this.textures[t].on("loaded",function(u){r.forceRender=!0})):(this.textures[t]=new L(this.gl,t,e),this.textures[t].on("loaded",function(u){r.forceRender=!0}))}},{key:"refreshUniforms",value:function(){this.uniforms={}}},{key:"setUniform",value:function(t){for(var i={},e=arguments.length,r=Array(e>1?e-1:0),u=1;u<e;u++)r[u-1]=arguments[u];i[t]=r,this.setUniforms(i)}},{key:"setUniforms",value:function(t){var i=P(t);for(var e in i)i[e].type==="sampler2D"?this.loadTexture(i[e].name,i[e].value[0]):this.uniform(i[e].method,i[e].type,i[e].name,i[e].value);this.forceRender=!0}},{key:"setMouse",value:function(t){var i=this.canvas.getBoundingClientRect();if(t&&t.x&&t.x>=i.left&&t.x<=i.right&&t.y&&t.y>=i.top&&t.y<=i.bottom){var e=(t.x-i.left)*this.realToCSSPixels,r=this.canvas.height-(t.y-i.top)*this.realToCSSPixels;this.uniform("2f","vec2","u_mouse",e,r)}}},{key:"uniform",value:function(t,i,e){this.uniforms[e]=this.uniforms[e]||{};for(var r=this.uniforms[e],u=arguments.length,s=Array(u>3?u-3:0),o=3;o<u;o++)s[o-3]=arguments[o];var l=ge(r.value,s);if(l||this.change||!r.location||!r.value){r.name=e,r.type=i,r.value=s,r.method="uniform"+t,this.gl.useProgram(this.program),r.location=this.gl.getUniformLocation(this.program,e),this.gl[r.method].apply(this.gl,[r.location].concat(r.value));for(var f in this.buffers){var h=this.buffers[f];this.gl.useProgram(h.program);var g=this.gl.getUniformLocation(h.program,e);this.gl[r.method].apply(this.gl,[g].concat(r.value))}}}},{key:"uniformTexture",value:function(t,i,e){if(this.textures[t]===void 0)this.loadTexture(t,i,e);else{this.uniform("1i","sampler2D",t,this.texureIndex);for(var r in this.buffers){var u=this.buffers[r];this.gl.useProgram(u.program),this.gl.activeTexture(this.gl.TEXTURE0+this.texureIndex),this.gl.bindTexture(this.gl.TEXTURE_2D,this.textures[t].texture)}this.gl.useProgram(this.program),this.gl.activeTexture(this.gl.TEXTURE0+this.texureIndex),this.gl.bindTexture(this.gl.TEXTURE_2D,this.textures[t].texture),this.uniform("2f","vec2",t+"Resolution",this.textures[t].width,this.textures[t].height)}}},{key:"resize",value:function(){if(this.width!==this.canvas.clientWidth||this.height!==this.canvas.clientHeight){this.realToCSSPixels=window.devicePixelRatio||1;var t=Math.floor(this.gl.canvas.clientWidth*this.realToCSSPixels),i=Math.floor(this.gl.canvas.clientHeight*this.realToCSSPixels);return(this.gl.canvas.width!==t||this.gl.canvas.height!==i)&&(this.gl.canvas.width=t,this.gl.canvas.height=i,this.gl.viewport(0,0,this.gl.canvas.width,this.gl.canvas.height)),this.width=this.canvas.clientWidth,this.height=this.canvas.clientHeight,this.resizeSwappableBuffers(),!0}else return!1}},{key:"render",value:function(){if(this.visible=fe(this.canvas),this.forceRender||this.change||this.animated&&this.visible&&!this.paused){var t=new Date,i=performance.now();this.timeDelta=(i-this.timePrev)/1e3,this.timePrev=i,this.nDelta>1&&this.uniform("1f","float","u_delta",this.timeDelta),this.nTime>1&&this.uniform("1f","float","u_time",(i-this.timeLoad)/1e3),this.nDate&&this.uniform("4f","float","u_date",t.getFullYear(),t.getMonth(),t.getDate(),t.getHours()*3600+t.getMinutes()*60+t.getSeconds()+t.getMilliseconds()*.001),this.uniform("2f","vec2","u_resolution",this.canvas.width,this.canvas.height);for(var e in this.buffers){var r=this.buffers[e];this.uniform("1i","sampler2D",r.name,r.bundle.input.index)}this.texureIndex=this.BUFFER_COUNT;for(var u in this.textures)this.uniformTexture(u),this.texureIndex++;this.renderPrograms(),this.trigger("render",{}),this.change=!1,this.forceRender=!1}}},{key:"pause",value:function(){this.paused=!0}},{key:"play",value:function(){this.paused=!1}},{key:"renderPrograms",value:function(){var t=this.gl,i=t.canvas.width,e=t.canvas.height;t.viewport(0,0,i,e);for(var r in this.buffers){var u=this.buffers[r];u.bundle.render(i,e,u.program,u.name),t.bindFramebuffer(t.FRAMEBUFFER,null)}t.useProgram(this.program),t.drawArrays(t.TRIANGLES,0,6)}},{key:"getBuffers",value:function(t){var i={};return t&&t.replace(/(?:^\s*)((?:#if|#elif)(?:\s*)(defined\s*\(\s*BUFFER_)(\d+)(?:\s*\))|(?:#ifdef)(?:\s*BUFFER_)(\d+)(?:\s*))/gm,function(){var e=arguments[3]||arguments[4];i["u_buffer"+e]={fragment:"#define BUFFER_"+e+`
`+t}}),i}},{key:"loadPrograms",value:function(t){var i=this,e=this.gl,r=y(i,i.vertexString,e.VERTEX_SHADER);for(var u in t){var s=t[u],o=y(i,s.fragment,e.FRAGMENT_SHADER,1);o?i.isValid=!0:(o=y(i,`void main(){
	gl_FragColor = vec4(1.0);
}`,e.FRAGMENT_SHADER),i.isValid=!1);var l=G(i,[r,o]);s.name=u,s.program=l,s.bundle=i.createSwappableBuffer(i.canvas.width,i.canvas.height,l),e.deleteShader(o)}e.deleteShader(r)}},{key:"createSwappableBuffer",value:function(t,i,e){var r=this.createBuffer(t,i,e),u=this.createBuffer(t,i,e),s=this.gl;return{input:r,output:u,swap:function(){var l=r;r=u,u=l,this.input=r,this.output=u},render:function(l,f,h,g){s.useProgram(h),s.viewport(0,0,l,f),s.bindFramebuffer(s.FRAMEBUFFER,this.input.buffer),s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,this.output.texture,0),s.drawArrays(s.TRIANGLES,0,6),this.swap()},resize:function(l,f,h,g){s.useProgram(h),s.viewport(0,0,l,f),this.input.resize(l,f),this.output.resize(l,f)}}}},{key:"createBuffer",value:function(t,i,e){var r=this.gl,u=this.BUFFER_COUNT;this.BUFFER_COUNT+=2,r.getExtension("OES_texture_float");var s=r.createTexture();r.activeTexture(r.TEXTURE0+u),r.bindTexture(r.TEXTURE_2D,s),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,t,i,0,r.RGBA,r.FLOAT,null),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE);var o=r.createFramebuffer();return{index:u,texture:s,buffer:o,W:t,H:i,resize:function(f,h){r.bindFramebuffer(r.FRAMEBUFFER,o);var g=Math.min(f,this.W),d=Math.min(h,this.H),E=new Float32Array(g*d*4);r.readPixels(0,0,g,d,r.RGBA,r.FLOAT,E),r.bindFramebuffer(r.FRAMEBUFFER,null);var v=u+1,T=r.createTexture();r.activeTexture(r.TEXTURE0+v),r.bindTexture(r.TEXTURE_2D,T),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,f,h,0,r.RGBA,r.FLOAT,null),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texSubImage2D(r.TEXTURE_2D,0,0,0,g,d,r.RGBA,r.FLOAT,E);var m=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,null),r.deleteTexture(s),r.activeTexture(r.TEXTURE0+u),r.bindTexture(r.TEXTURE_2D,T),u=this.index=u,s=this.texture=T,o=this.buffer=m,this.W=f,this.H=h}}}},{key:"resizeSwappableBuffers",value:function(){var t=this.gl,i=t.canvas.width,e=t.canvas.height;t.viewport(0,0,i,e);for(var r in this.buffers){var u=this.buffers[r];u.bundle.resize(i,e,u.program,u.name)}t.useProgram(this.program)}},{key:"version",value:function(){return"0.1.7"}}]),a}();function ve(){var a=document.getElementsByClassName("glslCanvas");if(a.length>0){window.glslCanvases=[];for(var n=0;n<a.length;n++){var t=new ce(a[n]);t.isValid&&window.glslCanvases.push(t)}}}window.addEventListener("load",function(){ve()});export{ce as G};
